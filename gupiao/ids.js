
// Function to fetch content from a Seeking Alpha API endpoint

let allLinks = document.getElementsByClassName('mr-14');

// Initialize an empty array to store the hrefs
let hrefArray = [];

// Loop through each element in allLinks and get the href attribute
for (let i = 0; i < allLinks.length; i++) {
    hrefArray.push(allLinks[i].href);
}

let ids = [];
for (let i = 0; i < hrefArray.length; i++) {
    ids.push(extractIdFromUrl(hrefArray[i].href));
}


// hrefArray now contains all the hrefs
console.log(hrefArray);

function extractIdFromUrl(url) {
    if(!url) return ;
    // Regular expression pattern to match the ID
    const pattern = /\/articles\/(\d+)/;

    // Extracting the ID using match method
    const match = url.match(pattern);

    // Checking if match is found
    if (match && match.length > 1) {
        return match[1];
    } else {
        return null; // ID not found in the URL
    }
}

async function fetchContent(articleId) {
    const apiUrl = `https://seekingalpha.com/api/v3/mp_articles/${articleId}?include=author%2Cauthor.authorResearch%2Cpresentations%2Cpresentations.slides%2CprimaryTickers%2CsecondaryTickers%2CsecondaryAuthor`;
    
    try {
        const response = await fetch(apiUrl, {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            }
        });
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error(`Error fetching article ${articleId}:`, error);
        return null;
    }
}

// Function to download a file
function download(content, fileName, mimeType) {
    const a = document.createElement('a');
    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }, 0);
}

// Function to process article IDs in batches
async function processBatch(batch, batchIndex) {
    const contents = [];
    for (const articleId of batch) {
        const content = await fetchContent(articleId);
        if (content) {
            contents.push(content);
        }
        // Random delay between 1 to 3 seconds
        await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
    }
    const jsonContent = JSON.stringify(contents, null, 2);
    download(jsonContent, `content_batch_${batchIndex + 1}.json`, 'application/json');
}

// Main function to process all article IDs
async function processArticleIds(articleIds) {
    const batchSize = 50;
    const batches = [];
    for (let i = 0; i < articleIds.length; i += batchSize) {
        batches.push(articleIds.slice(i, i + batchSize));
    }

    for (let i = 0; i < batches.length; i++) {
        console.log(`Processing batch ${i + 1} of ${batches.length}`);
        await processBatch(batches[i], i);
        // Longer delay between batches (5 to 10 seconds)
        await new Promise(resolve => setTimeout(resolve, 5000 + Math.random() * 5000));
    }
}

// Start processing the article IDs
processArticleIds(temp2);
var ids = [
    null,
    "6024861",
    "6024226",
    "6023971",
    "6023336",
    "6020191",
    "6021519",
    "6021502",
    "6020951",
    "6020878",
    "6020439",
    "6019678",
    "6019083",
    "6018988",
    "6017584",
    "6017139",
    "6016767",
    "6017090",
    "6015359",
    "6016592",
    "6016512",
    "6015108",
    "6014484",
    "6013800",
    "6013278",
    "6012769",
    "6011928",
    "6011225",
    "6011321",
    "6009346",
    "6011071",
    "6010245",
    "6008726",
    "6007937",
    "6007755",
    "6006424",
    "6005288",
    "6003643",
    "6003626",
    "6002161",
    "6001834",
    "6001370",
    "6001610",
    "6001572",
    "6000906",
    "6000642",
    "6000090",
    "5964029",
    "5999042",
    "5998329",
    "5997717",
    "5996373",
    "5996221",
    "5995295",
    "5991860",
    "5993814",
    "5993375",
    "5993148",
    "5992205",
    "5991073",
    "5991219",
    "5991176",
    "5990455",
    "5989515",
    "5988701",
    "5988425",
    "5987378",
    "5986986",
    "5986446",
    "5984850",
    "5985789",
    "5984179",
    "5983436",
    "5983032",
    "5981724",
    "5982105",
    "5982043",
    "5979755",
    "5980203",
    "5980183",
    "5979335",
    "5979015",
    "5977438",
    "5977333",
    "5976903",
    "5971797",
    "5974752",
    "5974156",
    "5973745",
    "5972323",
    "5972016",
    "5971905",
    "5969068",
    "5969909",
    "5969749",
    "5969708",
    "5968119",
    "5967624",
    "5966802",
    "5965838",
    "5965060",
    "5964561",
    "5964279",
    "5963665",
    "5963180",
    "5962387",
    "5961729",
    "5960791",
    "5960334",
    "5959389",
    "5959949",
    "5959681",
    "5959645",
    "5959199",
    "5958039",
    "5957272",
    "5957004",
    "5955522",
    "5955038",
    "5954207",
    "5953643",
    "5953716",
    "5953175",
    "5952749",
    "5952699",
    "5950125",
    "5951517",
    "5950949",
    "5950805",
    "5949632",
    "5947694",
    "5949081",
    "5948476",
    "5948416",
    "5947608",
    "5946850",
    "5946531",
    "5946146",
    "5945412",
    "5945060",
    "5944513",
    "5943787",
    "5942126",
    "5940976",
    "5932172",
    "5939392",
    "5938807",
    "5938666",
    "5937460",
    "5937231",
    "5936596",
    "5936582",
    "5935040",
    "5934474",
    "5933603",
    "5933838",
    "5933753",
    "5929680",
    "5930886",
    "5930864",
    "5930641",
    "5929889",
    "5929294",
    "5928208",
    "5927245",
    "5926964",
    "5926301",
    "5925464",
    "5925428",
    "5924655",
    "5924164",
    "5923294",
    "5922532",
    "5922676",
    "5922272",
    "5921853",
    "5920687",
    "5920063",
    "5919288",
    "5919057",
    "5917006",
    "5917282",
    "5916702",
    "5915559",
    "5916041",
    "5914288",
    "5914996",
    "5914431",
    "5914408",
    "5913795",
    "5913165",
    "5912735",
    "5912660",
    "5911173",
    "5911430",
    "5910704",
    "5909978",
    "5909540",
    "5908449",
    "5908201",
    "5908009",
    "5907831",
    "5903767",
    "5905458",
    "5904739",
    "5902635",
    "5902638",
    "5902708",
    "5901658",
    "5900589",
    "5899824",
    "5899601",
    "5898419",
    "5897321",
    "5897247",
    "5896188",
    "5894646",
    "5893946",
    "5894509",
    "5893879",
    "5892471",
    "5890673",
    "5891988",
    "5891949",
    "5889675",
    "5888791",
    "5888957",
    "5888381",
    "5886931",
    "5886285",
    "5885321",
    "5885138",
    "5884954",
    "5883872",
    "5883244",
    "5882310",
    "5881554",
    "5880379",
    "5880131",
    "5880315",
    "5880254",
    "5878584",
    "5878057",
    "5876606",
    "5877291",
    "5875583",
    "5876029",
    "5874280",
    "5874208",
    "5873841",
    "5872936",
    "5873125",
    "5871173",
    "5871126",
    "5871048",
    "5870810",
    "5870351",
    "5869864",
    "5868281",
    "5868267",
    "5866772",
    "5866950",
    "5865337",
    "5864293",
    "5864263",
    "5862493",
    "5862097",
    "5860964",
    "5859847",
    "5859771",
    "5859358",
    "5858628",
    "5858151",
    "5856078",
    "5857059",
    "5857066",
    "5854638",
    "5853371",
    "5854084",
    "5853619",
    "5849564",
    "5851074",
    "5851164",
    "5850880",
    "5850355",
    "5846830",
    "5849314",
    "5848276",
    "5848256",
    "5848535",
    "5848225",
    "5847809",
    "5846646",
    "5845848",
    "5844671",
    "5845085",
    "5845070",
    "5844787",
    "5843918",
    "5841921",
    "5842076",
    "5841207",
    "5840553",
    "5840128",
    "5839984",
    "5838760",
    "5838190",
    "5835846",
    "5835749",
    "5835495",
    "5835607",
    "5834459",
    "5834560",
    "5834206",
    "5833964",
    "5832419",
    "5832404",
    "5830576",
    "5827919",
    "5828689",
    "5821929",
    "5826949",
    "5825863",
    "5825744",
    "5825164",
    "5824892",
    "5822631",
    "5821429",
    "5821776",
    "5819871",
    "5819836",
    "5819823",
    "5819731",
    "5817630",
    "5817284",
    "5814786",
    "5816659",
    "5814967",
    "5812685",
    "5814339",
    "5814188",
    "5813666",
    "5812004",
    "5809870",
    "5810580",
    "5809199",
    "5809186",
    "5809104",
    "5808325",
    "5808214",
    "5807707",
    "5807367",
    "5805761",
    "5806296",
    "5805326",
    "5804934",
    "5804288",
    "5803727",
    "5803639",
    "5803308",
    "5802659",
    "5802076",
    "5801709",
    "5800587",
    "5800802",
    "5800151",
    "5800007",
    "5799517",
    "5799292",
    "5798776",
    "5798251",
    "5797959",
    "5797865",
    "5797830",
    "5797678",
    "5797499",
    "5797252",
    "5797006",
    "5796716",
    "5796520",
    "5795830",
    "5795069",
    "5794961",
    "5793729",
    "5794364",
    "5794090",
    "5793383",
    "5792185",
    "5792079",
    "5791491",
    "5790814",
    "5790830",
    "5789102",
    "5788077",
    "5786395",
    "5786398",
    "5786009",
    "5785297",
    "5782498",
    "5783534",
    "5783526",
    "5782463",
    "5780936",
    "5780177",
    "5780635",
    "5779952",
    "5778247",
    "5777550",
    "5777501",
    "5777196",
    "5776636",
    "5775665",
    "5775576",
    "5775315",
    "5774498",
    "5774245",
    "5773098",
    "5772792",
    "5772164",
    "5772023",
    "5771747",
    "5770619",
    "5770509",
    "5770239",
    "5770218",
    "5769495",
    "5766907",
    "5767824",
    "5767150",
    "5766764",
    "5766514",
    "5766277",
    "5765683",
    "5764981",
    "5765260",
    "5765261",
    "5764534",
    "5764116",
    "5763682",
    "5763613",
    "5763338",
    "5762759",
    "5762651",
    "5762614",
    "5762561",
    "5762371",
    "5762121",
    "5761825",
    "5761305",
    "5761124",
    "5760860",
    "5759638",
    "5759342",
    "5759573",
    "5759450",
    "5759236",
    "5759117",
    "5758208",
    "5758447",
    "5758019",
    "5756525",
    "5752116",
    "5756057",
    "5753893",
    "5754033",
    "5754010",
    "5753706",
    "5753228",
    "5752791",
    "5751421",
    "5750808",
    "5750919",
    "5750728",
    "5748453",
    "5749002",
    "5748615",
    "5747549",
    "5746560",
    "5746312",
    "5745667",
    "5745003",
    "5743449",
    "5744056",
    "5744040",
    "5742154",
    "5741272",
    "5741515",
    "5738832",
    "5738927",
    "5738488",
    "5738095",
    "5737656",
    "5736069",
    "5736307",
    "5736448",
    "5735945",
    "5735846",
    "5734637",
    "5734965",
    "5733326",
    "5733932",
    "5733923",
    "5732906",
    "5732789",
    "5732391",
    "5731921",
    "5731186",
    "5731308",
    "5730580",
    "5730079",
    "5730067",
    "5729623",
    "5729836",
    "5729403",
    "5729298",
    "5729162",
    "5728986",
    "5726863",
    "5728018",
    "5727778",
    "5727766",
    "5727573",
    "5727409",
    "5727335",
    "5727144",
    "5724713",
    "5725757",
    "5725583",
    "5725539",
    "5725381",
    "5725375",
    "5725367",
    "5719819",
    "5721958",
    "5723237",
    "5722170",
    "5718811",
    "5718158",
    "5719222",
    "5716209",
    "5717995",
    "5717201",
    "5714283",
    "5715118",
    "5714684",
    "5711590",
    "5712757",
    "5711507",
    "5708648",
    "5709571",
    "5708968",
    "5708584",
    "5707771",
    "5707016",
    "5703421",
    "5704588",
    "5705022",
    "5704643",
    "5704354",
    "5703727",
    "5703839",
    "5703532",
    "5702968",
    "5701710",
    "5702053",
    "5701862",
    "5701459",
    "5701229",
    "5701098",
    "5701095",
    "5701092",
    "5701090",
    "5701078",
    "5691868",
    "5698605",
    "5696257",
    "5690109",
    "5693428",
    "5693342",
    "5693297",
    "5692699",
    "5692095",
    "5687817",
    "5691443",
    "5689658",
    "5685227",
    "5688688",
    "5687912",
    "5682904",
    "5685430",
    "5679533",
    "5681220",
    "5681192",
    "5678084",
    "5680309",
    "5672984",
    "5674545",
    "5675717",
    "5675401",
    "5669661",
    "5673554",
    "5672660",
    "5669729",
    "5670233",
    "5669926",
    "5669773",
    "5669494",
    "5666375",
    "5666196",
    "5666162",
    "5661880",
    "5664168",
    "5663756",
    "5663246",
    "5659561",
    "5662229",
    "5661507",
    "5661180",
    "5661028",
    "5660772",
    "5660551",
    "5660344",
    "5656886",
    "5659161",
    "5659097",
    "5658974",
    "5658888",
    "5658714",
    "5657592",
    "5657377",
    "5656912",
    "5654031",
    "5656180",
    "5655952",
    "5655488",
    "5654507",
    "5651104",
    "5653113",
    "5652862",
    "5651497",
    "5651495",
    "5651492",
    "5651487",
    "5649394",
    "5640704",
    "5645897",
    "5644945",
    "5645479",
    "5645257",
    "5644614",
    "5644601",
    "5641232",
    "5641668",
    "5638168",
    "5639165",
    "5634039",
    "5636975",
    "5631247",
    "5631711",
    "5634242",
    "5633605",
    "5628911",
    "5630728",
    "5627214",
    "5629766",
    "5629516",
    "5629338",
    "5628331",
    "5628065",
    "5627907",
    "5623916",
    "5620908",
    "5626805",
    "5626554",
    "5625993",
    "5625857",
    "5625841",
    "5625537",
    "5625589",
    "5620465",
    "5623740",
    "5623678",
    "5623593",
    "5623426",
    "5623396",
    "5623411",
    "5623400",
    "5621992",
    "5621544",
    "5618141",
    "5621120",
    "5621087",
    "5620039",
    "5619977",
    "5614739",
    "5617438",
    "5617358",
    "5616265",
    "5615686",
    "5612394",
    "5613436",
    "5609843",
    "5612810",
    "5611528",
    "5611007",
    "5607408",
    "5610052",
    "5608316",
    "5604063",
    "5607194",
    "5605529",
    "5601193",
    "5604951",
    "5602806",
    "5600184",
    "5601422",
    "5600039",
    "5596282",
    "5599331",
    "5597727",
    "5597276",
    "5597174",
    "5593725",
    "5595303",
    "5594395",
    "5590988",
    "5593651",
    "5591469",
    "5591228",
    "5587528",
    "5589860",
    "5588574",
    "5581252",
    "5586299",
    "5585577",
    "5585570",
    "5581668",
    "5585098",
    "5584000",
    "5583528",
    "5582861"
]